!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e():"function"==typeof define&&define.amd?define(e):e()}(0,function(){"use strict";!function t(e,r,n){function i(o,h){if(!r[o]){if(!e[o]){var s="function"==typeof require&&require;if(!h&&s)return s(o,!0);if(a)return a(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var f=r[o]={exports:{}};e[o][0].call(f.exports,function(t){var r=e[o][1][t];return i(r||t)},f,f.exports,t,e,r,n)}return r[o].exports}for(var a="function"==typeof require&&require,o=0;o<n.length;o++)i(n[o]);return i}({1:[function(t,e,r){function n(t){return Object.prototype.toString.call(t)}function i(t){return"[object Function]"===n(t)}function a(t,e,n,a){return i(n)&&(a=n,n={}),isNaN(n)||(n={quality:n,alpha:!1}),s||(r.WW=!1),s&&r.WW?(r.debug("Resize buffer in WebWorker"),f(t,e,n,a)):(r.debug("Resize buffer sync (freeze event loop)"),u(t,e,n,a))}function o(t,e){var r={src:t.src,dest:t.dest,width:0|t.width,height:0|t.height,toWidth:0|t.toWidth,toHeight:0|t.toHeight,quality:t.quality,alpha:t.alpha,unsharpAmount:t.unsharpAmount,unsharpRadius:t.unsharpRadius,unsharpThreshold:t.unsharpThreshold};r.dest=d(r),r.unsharpAmount&&l(r.dest,r.toWidth,r.toHeight,r.unsharpAmount,r.unsharpRadius,r.unsharpThreshold),e(null,r.dest)}function h(t){u.terminate(t),f.terminate(t)}var s="undefined"!=typeof window&&"Worker"in window;if(s)try{t("webworkify")(function(){}).terminate()}catch(t){s=!1}var u=t("./lib/resize_js"),f=t("./lib/resize_js_ww"),d=t("./lib/js/resize_array"),l=t("./lib/js/unsharp"),r=(t("object-assign"),{});r.resizeCanvas=a,r.resizeBuffer=o,r.terminate=h,r.WW=s,r.debug=function(){},window.pica=r},{"./lib/js/resize_array":5,"./lib/js/unsharp":6,"./lib/resize_js":9,"./lib/resize_js_ww":10,"object-assign":12,webworkify:13}],2:[function(t,e,r){e.exports=function(){return document.createElement("canvas")}},{}],3:[function(t,e,r){var n=1;e.exports=function(){return n++}},{}],4:[function(t,e,r){function n(t){this.create=t,this.available=[],this.acquired={},this.lastId=1,this.timeoutId=0}n.prototype.acquire=function(){var t,e=this;return 0!==this.available.length?t=this.available.pop():(t=this.create(),t.id=this.lastId++,t.release=function(){e.release(t)}),this.acquired[t.id]=t,t},n.prototype.release=function(t){delete this.acquired[t.id],t.lastUsed=Date.now(),this.available.push(t),0===this.timeoutId&&(this.timeoutId=setTimeout(this.gc.bind(this),500))},n.prototype.gc=function(){var t=Date.now();this.available=this.available.filter(function(e){return!(t-e.lastUsed>2e3)||(e.destroy(),!1)}),0!==this.available.length?this.timeoutId=setTimeout(this.gc.bind(this),500):this.timeoutId=0},e.exports=n},{}],5:[function(t,e,r){function n(t){return t<0?0:t>255?255:t}function i(t){return Math.round(t*((1<<f)-1))}function a(t,e,r,n,a){var o,h,s,u,f,l,c,p,g,w,v,b,m,y,j,M,x,I=d[t].filter,W=1/n,O=Math.min(1,n),R=d[t].win/O,H=Math.floor(2*(R+1)),_=new Int16Array((H+2)*r),T=0;for(o=0;o<r;o++){for(h=(o+.5)*W+a,s=Math.max(0,Math.floor(h-R)),u=Math.min(e-1,Math.ceil(h+R)),f=u-s+1,l=new Float32Array(f),c=new Int16Array(f),p=0,g=s,w=0;g<=u;g++,w++)v=I((g+.5-h)*O),p+=v,l[w]=v;for(b=0,w=0;w<l.length;w++)m=l[w]/p,b+=m,c[w]=i(m);for(c[r>>1]+=i(1-b),y=0;y<c.length&&0===c[y];)y++;if(y<c.length){for(j=c.length-1;j>0&&0===c[j];)j--;M=s+y,x=j-y+1,_[T++]=M,_[T++]=x,_.set(c.subarray(y,j+1),T),T+=x}else _[T++]=0,_[T++]=0}return _}function o(t,e,r,i,a,o){var h,s,u,f,d,l,c,p,g,w,v,b=0,m=0;for(g=0;g<i;g++){for(d=0,w=0;w<a;w++){for(l=o[d++],c=o[d++],p=b+4*l|0,h=s=u=f=0;c>0;c--)v=o[d++],f=f+v*t[p+3]|0,u=u+v*t[p+2]|0,s=s+v*t[p+1]|0,h=h+v*t[p]|0,p=p+4|0;e[m+3]=n(f+8192>>14),e[m+2]=n(u+8192>>14),e[m+1]=n(s+8192>>14),e[m]=n(h+8192>>14),m=m+4*i|0}m=4*(g+1)|0,b=(g+1)*r*4|0}}function h(t,e,r,i,a,o){var h,s,u,f,d,l,c,p,g,w,v,b=0,m=0;for(g=0;g<i;g++){for(d=0,w=0;w<a;w++){for(l=o[d++],c=o[d++],p=b+4*l|0,h=s=u=f=0;c>0;c--)v=o[d++],f=f+v*t[p+3]|0,u=u+v*t[p+2]|0,s=s+v*t[p+1]|0,h=h+v*t[p]|0,p=p+4|0;e[m+3]=n(f+8192>>14),e[m+2]=n(u+8192>>14),e[m+1]=n(s+8192>>14),e[m]=n(h+8192>>14),m=m+4*i|0}m=4*(g+1)|0,b=(g+1)*r*4|0}}function s(t,e,r){for(var n=3,i=e*r*4|0;n<i;)t[n]=255,n=n+4|0}function u(t){var e=t.src,r=t.width,n=t.height,i=t.toWidth,u=t.toHeight,f=t.scaleX||t.toWidth/t.width,d=t.scaleY||t.toHeight/t.height,l=t.offsetX||0,c=t.offsetY||0,p=t.dest||new Uint8Array(i*u*4),g=void 0===t.quality?3:t.quality,w=t.alpha||!1;if(r<1||n<1||i<1||u<1)return[];var v=a(g,r,i,f,l),b=a(g,n,u,d,c),m=new Uint8Array(i*n*4);return o(e,m,r,n,i,v),h(m,p,n,i,u,b),w||s(p,i,u),p}var f=14,d=[{win:.5,filter:function(t){return t>=-.5&&t<.5?1:0}},{win:1,filter:function(t){if(t<=-1||t>=1)return 0;if(t>-1.1920929e-7&&t<1.1920929e-7)return 1;var e=t*Math.PI;return Math.sin(e)/e*(.54+.46*Math.cos(e/1))}},{win:2,filter:function(t){if(t<=-2||t>=2)return 0;if(t>-1.1920929e-7&&t<1.1920929e-7)return 1;var e=t*Math.PI;return Math.sin(e)/e*Math.sin(e/2)/(e/2)}},{win:3,filter:function(t){if(t<=-3||t>=3)return 0;if(t>-1.1920929e-7&&t<1.1920929e-7)return 1;var e=t*Math.PI;return Math.sin(e)/e*Math.sin(e/3)/(e/3)}}];e.exports=u},{}],6:[function(t,e,r){function n(t,e,r){for(var n,i,a,o,h,s=e*r,u=new Uint16Array(s),f=0;f<s;f++)n=t[4*f],i=t[4*f+1],a=t[4*f+2],h=n>=i&&n>=a?n:i>=a&&i>=n?i:a,o=n<=i&&n<=a?n:i<=a&&i<=n?i:a,u[f]=257*(h+o)>>1;return u}function i(t,e,r,i,o,h){var s,u,f,d,l,c,p,g,w,v,b,m,y;if(!(0===i||o<.5)){o>2&&(o=2);var j=n(t,e,r),M=new Uint16Array(j);a(M,e,r,o);for(var x=i/100*4096+.5|0,I=257*h|0,W=e*r,O=0;O<W;O++)m=2*(j[O]-M[O]),Math.abs(m)>=I&&(y=4*O,s=t[y],u=t[y+1],f=t[y+2],g=s>=u&&s>=f?s:u>=s&&u>=f?u:f,p=s<=u&&s<=f?s:u<=s&&u<=f?u:f,c=257*(g+p)>>1,p===g?d=l=0:(l=c<=32767?4095*(g-p)/(g+p)|0:4095*(g-p)/(510-g-p)|0,d=s===g?65535*(u-f)/(6*(g-p))|0:u===g?21845+(65535*(f-s)/(6*(g-p))|0):43690+(65535*(s-u)/(6*(g-p))|0)),c+=x*m+2048>>12,c>65535?c=65535:c<0&&(c=0),0===l?s=u=f=c>>8:(v=c<=32767?c*(4096+l)+2048>>12:c+((65535-c)*l+2048>>12),w=2*c-v>>8,v>>=8,b=d+21845&65535,s=b>=43690?w:b>=32767?w+(6*(v-w)*(43690-b)+32768>>16):b>=10922?v:w+(6*(v-w)*b+32768>>16),b=65535&d,u=b>=43690?w:b>=32767?w+(6*(v-w)*(43690-b)+32768>>16):b>=10922?v:w+(6*(v-w)*b+32768>>16),b=d-21845&65535,f=b>=43690?w:b>=32767?w+(6*(v-w)*(43690-b)+32768>>16):b>=10922?v:w+(6*(v-w)*b+32768>>16)),t[y]=s,t[y+1]=u,t[y+2]=f)}}var a=t("glur/mono16");e.exports=i,e.exports.lightness=n},{"glur/mono16":11}],7:[function(t,e,r){function n(t){var e=Math.round(t);return Math.abs(t-e)<a?e:Math.floor(t)}function i(t){var e=Math.round(t);return Math.abs(t-e)<a?e:Math.ceil(t)}var a=1e-5;e.exports.createRegions=function(t){var e,r,a,o,h,s,u,f=t.toWidth/t.width,d=t.toHeight/t.height,l=n(t.srcTileSize*f)-2*t.destTileBorder,c=n(t.srcTileSize*d)-2*t.destTileBorder,p=[];for(o=0;o<t.toHeight;o+=c)for(a=0;a<t.toWidth;a+=l)e=a-t.destTileBorder,e<0&&(e=0),h=a+l+t.destTileBorder-e,e+h>=t.toWidth&&(h=t.toWidth-e),r=o-t.destTileBorder,r<0&&(r=0),s=o+c+t.destTileBorder-r,r+s>=t.toHeight&&(s=t.toHeight-r),u={toX:e,toY:r,toWidth:h,toHeight:s,toInnerX:a,toInnerY:o,toInnerWidth:l,toInnerHeight:c,offsetX:e/f-n(e/f),offsetY:r/d-n(r/d),scaleX:f,scaleY:d,x:n(e/f),y:n(r/d),width:i(h/f),height:i(s/d)},p.push(u);return p},e.exports.eachLimit=function(t,e,r,n){function i(e){if(!h){if(e)return h=!0,void n(e);o++,o===t.length?n():a<t.length&&r(t[a++],i)}}0===t.length&&n();for(var a=0,o=0,h=!1;a<e&&a<t.length;)r(t[a++],i)}},{}],8:[function(t,e,r){e.exports=function(e){var r=t("./resize_array"),n=t("./unsharp");e.onmessage=function(t){var i=t.data;i.dest=new Uint8Array(i.toWidth*i.toHeight*4),r(i),i.unsharpAmount&&n(i.dest,i.toWidth,i.toHeight,i.unsharpAmount,i.unsharpRadius,i.unsharpThreshold),e.postMessage({output:i.dest},[i.dest.buffer])}}},{"./resize_array":5,"./unsharp":6}],9:[function(t,e,r){function n(t,e,r,n){var l=e.getContext("2d",{alpha:Boolean(r.alpha)}),c=u();c.width=Math.min(f,t.width),c.height=Math.min(f,t.height);var p=c.getContext("2d",{alpha:Boolean(r.alpha)});p.globalCompositeOperation="copy";var g=o({width:t.naturalWidth||t.width,height:t.naturalHeight||t.height,srcTileSize:f,toWidth:e.width,toHeight:e.height,destTileBorder:Math.ceil(Math.max(d,2.5*r.unsharpRadius|0))});return h(g,1,function(e,n){p.drawImage(t,e.x,e.y,e.width,e.height,0,0,e.width,e.height);var o=p.getImageData(0,0,e.width,e.height),h=l.createImageData(e.toWidth,e.toHeight),s={src:o.data,dest:h.data,width:e.width,height:e.height,toWidth:e.toWidth,toHeight:e.toHeight,scaleX:e.scaleX,scaleY:e.scaleY,offsetX:e.offsetX,offsetY:e.offsetY,quality:r.quality,alpha:r.alpha,unsharpAmount:r.unsharpAmount,unsharpRadius:r.unsharpRadius,unsharpThreshold:r.unsharpThreshold};i(s),r.unsharpAmount&&a(s.dest,s.toWidth,s.toHeight,s.unsharpAmount,s.unsharpRadius,s.unsharpThreshold),l.putImageData(h,e.toX,e.toY,e.toInnerX-e.toX,e.toInnerY-e.toY,e.toInnerWidth,e.toInnerHeight),n()},n),s()}var i=t("./js/resize_array"),a=t("./js/unsharp"),o=t("./js/utils").createRegions,h=t("./js/utils").eachLimit,s=t("./js/generate_id"),u=t("./js/create_canvas_browser"),f=1024,d=3;e.exports=n,e.exports.terminate=function(){}},{"./js/create_canvas_browser":2,"./js/generate_id":3,"./js/resize_array":5,"./js/unsharp":6,"./js/utils":7}],10:[function(t,e,r){function n(t,e,r,n){var i=e.getContext("2d",{alpha:Boolean(r.alpha)}),a=f();a.width=Math.min(l,t.naturalWidth||t.width),a.height=Math.min(l,t.naturalHeight||t.height);var o=a.getContext("2d",{alpha:Boolean(r.alpha)});o.globalCompositeOperation="copy";var d=h({width:t.naturalWidth||t.width,height:t.naturalHeight||t.height,srcTileSize:l,toWidth:e.width,toHeight:e.height,destTileBorder:Math.ceil(Math.max(c,2.5*r.unsharpRadius|0))}),v=1;"undefined"!=typeof navigator&&(v=navigator.hardwareConcurrency||1);var b=r._id||u();return w[b]=!0,s(d,v,function(e,n){o.drawImage(t,e.x,e.y,e.width,e.height,0,0,e.width,e.height);var a=o.getImageData(0,0,e.width,e.height),h={src:a.data,width:e.width,height:e.height,toWidth:e.toWidth,toHeight:e.toHeight,scaleX:e.scaleX,scaleY:e.scaleY,offsetX:e.offsetX,offsetY:e.offsetY,quality:r.quality,alpha:r.alpha,unsharpAmount:r.unsharpAmount,unsharpRadius:r.unsharpRadius,unsharpThreshold:r.unsharpThreshold},s=g.acquire();s.value.onmessage=function(t){var r,a,o,h,u;if(s.release(),!w[b])return void n(!0);if(t.data.err)return void n(t.data.err);if(o=i.createImageData(e.toWidth,e.toHeight),h=t.data.output,u=o.data,u.set)u.set(h);else for(r=0,a=h.length;r<a;r++)u[r]=h[r];p?i.putImageData(o,e.toX,e.toY,e.toInnerX-e.toX,e.toInnerY-e.toY,e.toInnerWidth+1e-5,e.toInnerHeight+1e-5):i.putImageData(o,e.toX,e.toY,e.toInnerX-e.toX,e.toInnerY-e.toY,e.toInnerWidth,e.toInnerHeight),n()},s.value.postMessage(h,[h.src.buffer])},function(t){w[b]&&(delete w[b],n(t))}),b}function i(t){w[t]&&delete w[t]}var a=t("webworkify"),o=t("./js/worker.js"),h=t("./js/utils").createRegions,s=t("./js/utils").eachLimit,u=t("./js/generate_id"),f=t("./js/create_canvas_browser"),d=t("./js/pool"),l=1024,c=3,p=!1;try{p=-1!==navigator.userAgent.indexOf("Safari")}catch(t){}var g=new d(function(){return{value:a(o),destroy:function(){if(this.value.terminate(),"undefined"!=typeof window){var t=window.URL||window.webkitURL||window.mozURL||window.msURL;t&&t.revokeObjectURL&&this.value.objectURL&&t.revokeObjectURL(this.value.objectURL)}}}}),w={};e.exports=n,e.exports.terminate=i},{"./js/create_canvas_browser":2,"./js/generate_id":3,"./js/pool":4,"./js/utils":7,"./js/worker.js":8,webworkify:13}],11:[function(t,e,r){function n(t){t<.5&&(t=.5);var e=Math.exp(.527076)/t,r=Math.exp(-e),n=Math.exp(-2*e),i=(1-r)*(1-r)/(1+2*e*r-n);return o=i,h=i*(e-1)*r,s=i*(e+1)*r,u=-i*n,f=2*r,d=-n,l=(o+h)/(1-f-d),c=(s+u)/(1-f-d),new Float32Array([o,h,s,u,f,d,l,c])}function i(t,e,r,n,i,a){var o,h,s,u,f,d,l,c,p,g,w,v,b,m;for(p=0;p<a;p++){for(d=p*i,l=p,c=0,o=t[d],f=o*n[6],u=f,w=n[0],v=n[1],b=n[4],m=n[5],g=0;g<i;g++)h=t[d],s=h*w+o*v+u*b+f*m,f=u,u=s,o=h,r[c]=u,c++,d++;for(d--,c--,l+=a*(i-1),o=t[d],f=o*n[7],u=f,h=o,w=n[2],v=n[3],g=i-1;g>=0;g--)s=h*w+o*v+u*b+f*m,f=u,u=s,o=h,h=t[d],e[l]=r[c]+u,d--,c--,l-=a}}function a(t,e,r,a){if(a){var o=new Uint16Array(t.length),h=new Float32Array(Math.max(e,r)),s=n(a);i(t,o,h,s,e,r,a),i(o,t,h,s,r,e,a)}}var o,h,s,u,f,d,l,c;e.exports=a},{}],12:[function(t,e,r){function n(t){if(null===t||void 0===t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}var i=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable;e.exports=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},r=0;r<10;r++)e["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(e).map(function(t){return e[t]}).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach(function(t){n[t]=t}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(t){return!1}}()?Object.assign:function(t,e){for(var r,o,h=n(t),s=1;s<arguments.length;s++){r=Object(arguments[s]);for(var u in r)i.call(r,u)&&(h[u]=r[u]);if(Object.getOwnPropertySymbols){o=Object.getOwnPropertySymbols(r);for(var f=0;f<o.length;f++)a.call(r,o[f])&&(h[o[f]]=r[o[f]])}}return h}},{}],13:[function(t,e,r){var n=arguments[3],i=arguments[4],a=arguments[5],o=JSON.stringify;e.exports=function(t,e){function r(t){w[t]=!0;for(var e in i[t][1]){var n=i[t][1][e];w[n]||r(n)}}for(var h,s=Object.keys(a),u=0,f=s.length;u<f;u++){var d=s[u],l=a[d].exports;if(l===t||l&&l.default===t){h=d;break}}if(!h){h=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var c={},u=0,f=s.length;u<f;u++){var d=s[u];c[d]=d}i[h]=[Function(["require","module","exports"],"("+t+")(self)"),c]}var p=Math.floor(Math.pow(16,8)*Math.random()).toString(16),g={};g[h]=h,i[p]=[Function(["require"],"var f = require("+o(h)+");(f.default ? f.default : f)(self);"),g];var w={};r(p);var v="("+n+")({"+Object.keys(w).map(function(t){return o(t)+":["+i[t][0]+","+o(i[t][1])+"]"}).join(",")+"},{},["+o(p)+"])",b=window.URL||window.webkitURL||window.mozURL||window.msURL,m=new Blob([v],{type:"text/javascript"});if(e&&e.bare)return m;var y=b.createObjectURL(m),j=new Worker(y);return j.objectURL=y,j}},{}]},{},[1])});