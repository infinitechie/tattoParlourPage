!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("ng2-img-max")):"function"==typeof define&&define.amd?define(["exports","@angular/core","rxjs","ng2-img-max"],t):t(e["ng2-img-tools"]=e["ng2-img-tools"]||{},e.ng.core,e.Rx,e.ng2ImgMax)}(this,function(e,t,r,n){"use strict";var i=function(e,t,r,n){var i,o=arguments.length,c=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(c=(o<3?i(c):o>3?i(t,r,c):i(t,r))||c);return o>3&&c&&Object.defineProperty(t,r,c),c},o=function(e,t){return function(r,n){t(r,n,e)}};e.ImgCropService=function(){function e(e){this.ng2ImgMaxService=e}return e.prototype.cropImage=function(e,t,n,i,o){var c=this;void 0===i&&(i=0),void 0===o&&(o=0);var a=new r.Subject;if("image/jpeg"!==e.type&&"image/png"!==e.type)return setTimeout(function(){a.error({croppedFile:e,reason:"File provided is neither of type jpg nor of type png.",error:"INVALID_EXTENSION"})},0),a.asObservable();var g=document.createElement("canvas"),u=g.getContext("2d"),s=new Image;return s.onload=function(){c.ng2ImgMaxService.getEXIFOrientedImage(s).then(function(r){window.URL.revokeObjectURL(s.src),g.width=t,g.height=n,u.drawImage(r,i,o,t,n,0,0,t,n);var f=u.getImageData(0,0,r.width,r.height),p=!0;("image/jpeg"===e.type||"image/png"===e.type&&!c.isImgUsingAlpha(f))&&(p=!1,u=g.getContext("2d",{alpha:!1}),u.drawImage(r,i,o,t,n,0,0,t,n)),g.toBlob(function(t){var r=c.generateResultFile(t,e.name,e.type,(new Date).getTime());a.next(r)},p?"image/png":"image/jpeg")})},s.src=window.URL.createObjectURL(e),a.asObservable()},e.prototype.isImgUsingAlpha=function(e){for(var t=0;t<e.data.length;t+=4)if(255!==e.data[t+3])return!0;return!1},e.prototype.generateResultFile=function(e,t,r,n){var i=new Blob([e],{type:r});return this.blobToFile(i,t,n)},e.prototype.blobToFile=function(e,t,r){var n=e;return n.name=t,n.lastModified=r,n},e}(),e.ImgCropService=i([t.Injectable(),o(0,t.Inject(t.forwardRef(function(){return n.Ng2ImgMaxService})))],e.ImgCropService);var c=function(e,t,r,n){var i,o=arguments.length,c=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(c=(o<3?i(c):o>3?i(t,r,c):i(t,r))||c);return o>3&&c&&Object.defineProperty(t,r,c),c},a=function(e,t){return function(r,n){t(r,n,e)}};e.ImgResizeExactService=function(){function e(e,t){this.ng2ImgMaxService=e,this.imgCropService=t}return e.prototype.resizeExactFill=function(e,t,n,i){var o=this,c=new r.Subject;if("image/jpeg"!==e.type&&"image/png"!==e.type)return setTimeout(function(){c.error({resizedFile:e,reason:"File provided is neither of type jpg nor of type png.",error:"INVALID_EXTENSION"})},0),c.asObservable();var a=new Image;return a.onload=function(){o.ng2ImgMaxService.getEXIFOrientedImage(a).then(function(r){window.URL.revokeObjectURL(a.src);var g=r.width/r.height,u=t/n,s=1e5,f=1e5;g>u?f=t:g<=u&&(s=n),o.ng2ImgMaxService.resize([e],f,s).subscribe(function(a){var g=0,u=0;if(1e5===f){var p=r.width/(r.height/n);g=(p-t)/2}else if(1e5===s){var l=r.height/(r.width/t);u=(l-n)/2}var m=new Image,v=document.createElement("canvas"),d=v.getContext("2d");m.onload=function(){v.width=t,v.height=n,i&&(d.fillStyle=i,d.fillRect(0,0,t,n)),d.drawImage(m,g,u,t,n,0,0,t,n);var r=d.getImageData(0,0,t,n),a=!0;("image/jpeg"===e.type||"image/png"===e.type&&!o.isImgUsingAlpha(r))&&(a=!1,d=v.getContext("2d",{alpha:!1}),i&&(d.fillStyle=i,d.fillRect(0,0,t,n)),d.drawImage(m,g,u,t,n,0,0,t,n)),v.toBlob(function(t){window.URL.revokeObjectURL(m.src);var r=o.generateResultFile(t,e.name,e.type,(new Date).getTime());c.next(r)},a?"image/png":"image/jpeg")},m.src=window.URL.createObjectURL(a)},function(e){c.error(e)})})},a.src=window.URL.createObjectURL(e),c.asObservable()},e.prototype.resizeExactCrop=function(e,t,n){var i=this,o=new r.Subject;if("image/jpeg"!==e.type&&"image/png"!==e.type)return setTimeout(function(){o.error({resizedFile:e,reason:"File provided is neither of type jpg nor of type png.",error:"INVALID_EXTENSION"})},0),o.asObservable();var c=new Image;return c.onload=function(){i.ng2ImgMaxService.getEXIFOrientedImage(c).then(function(r){window.URL.revokeObjectURL(c.src);var a=r.width/r.height,g=t/n,u=1e5,s=1e5,f=0,p=0;a>g?u=n:a<=g&&(s=t),i.ng2ImgMaxService.resize([e],s,u).subscribe(function(e){if(1e5===s){var c=r.width/(r.height/n);f=(c-t)/2}else if(1e5===u){var a=r.height/(r.width/t);p=(a-n)/2}i.imgCropService.cropImage(e,t,n,f,p).subscribe(function(e){o.next(e)},function(e){o.error(e)})},function(e){o.error(e)})})},c.src=window.URL.createObjectURL(e),o.asObservable()},e.prototype.isImgUsingAlpha=function(e){for(var t=0;t<e.data.length;t+=4)if(255!==e.data[t+3])return!0;return!1},e.prototype.generateResultFile=function(e,t,r,n){var i=new Blob([e],{type:r});return this.blobToFile(i,t,n)},e.prototype.blobToFile=function(e,t,r){var n=e;return n.name=t,n.lastModified=r,n},e}(),e.ImgResizeExactService=c([t.Injectable(),a(0,t.Inject(t.forwardRef(function(){return n.Ng2ImgMaxService}))),a(1,t.Inject(t.forwardRef(function(){return e.ImgCropService})))],e.ImgResizeExactService);var g=function(e,t,r,n){var i,o=arguments.length,c=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(c=(o<3?i(c):o>3?i(t,r,c):i(t,r))||c);return o>3&&c&&Object.defineProperty(t,r,c),c},u=function(e,t){return function(r,n){t(r,n,e)}};e.Ng2ImgToolsService=function(){function e(e,t,r){this.imgResizeExactService=e,this.ng2ImgMaxService=t,this.imgCropService=r}return e.prototype.compress=function(e,t,r,n){return void 0===r&&(r=!1),void 0===n&&(n=!1),this.ng2ImgMaxService.compress(e,t,r,n)},e.prototype.resize=function(e,t,r,n){return void 0===n&&(n=!1),this.ng2ImgMaxService.resize(e,t,r,n)},e.prototype.crop=function(e,t,n,i,o){var c=this;void 0===i&&(i=0),void 0===o&&(o=0);var a=new r.Subject;return e.forEach(function(e){c.cropImage(e,t,n,i,o).subscribe(function(e){a.next(e)},function(e){a.error(e)})}),a.asObservable()},e.prototype.resizeExactCrop=function(e,t,n){var i=this,o=new r.Subject;return e.forEach(function(e){i.resizeExactCropImage(e,t,n).subscribe(function(e){o.next(e)},function(e){o.error(e)})}),o.asObservable()},e.prototype.resizeExactFill=function(e,t,n,i){var o=this,c=new r.Subject;return e.forEach(function(e){o.resizeExactFillImage(e,t,n,i).subscribe(function(e){c.next(e)},function(e){c.error(e)})}),c.asObservable()},e.prototype.resizeExactFillImage=function(e,t,r,n){return this.imgResizeExactService.resizeExactFill(e,t,r,n)},e.prototype.resizeExactCropImage=function(e,t,r){return this.imgResizeExactService.resizeExactCrop(e,t,r)},e.prototype.cropImage=function(e,t,r,n,i){return void 0===n&&(n=0),void 0===i&&(i=0),this.imgCropService.cropImage(e,t,r,n,i)},e.prototype.compressImage=function(e,t,r,n){return void 0===r&&(r=!1),void 0===n&&(n=!1),this.ng2ImgMaxService.compressImage(e,t,r,n)},e.prototype.resizeImage=function(e,t,r,n){return void 0===n&&(n=!1),this.ng2ImgMaxService.resizeImage(e,t,r,n)},e.prototype.getEXIFOrientedImage=function(e){return this.ng2ImgMaxService.getEXIFOrientedImage(e)},e}(),e.Ng2ImgToolsService=g([t.Injectable(),u(0,t.Inject(t.forwardRef(function(){return e.ImgResizeExactService}))),u(1,t.Inject(t.forwardRef(function(){return n.Ng2ImgMaxService}))),u(2,t.Inject(t.forwardRef(function(){return e.ImgCropService})))],e.Ng2ImgToolsService);var s=function(e,t,r,n){var i,o=arguments.length,c=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(c=(o<3?i(c):o>3?i(t,r,c):i(t,r))||c);return o>3&&c&&Object.defineProperty(t,r,c),c};e.Ng2ImgToolsModule=function(){function e(){}return e}(),e.Ng2ImgToolsModule=s([t.NgModule({imports:[n.Ng2ImgMaxModule],providers:[{provide:e.ImgResizeExactService,useClass:e.ImgResizeExactService},{provide:e.ImgCropService,useClass:e.ImgCropService},{provide:e.Ng2ImgToolsService,useClass:e.Ng2ImgToolsService},{provide:n.Ng2ImgMaxService,useClass:n.Ng2ImgMaxService}]})],e.Ng2ImgToolsModule),Object.defineProperty(e,"__esModule",{value:!0})});